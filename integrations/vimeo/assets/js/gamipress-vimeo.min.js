var gamipress_vimeo_videos={};var gamipress_vimeo_players={};var players=document.querySelectorAll('.gamipress-vimeo-video');for(var i=0;i<players.length;i++){var player=players[i];if(player.firstChild){player.removeChild(player.firstChild)}
var id=player.getAttribute('data-id');var url=player.getAttribute('data-url');var from_url=player.getAttribute('data-from-url');gamipress_vimeo_players[id]=new Vimeo.Player(player,{id:(from_url==='yes'?url:id),height:player.getAttribute('data-height'),width:player.getAttribute('data-width')});gamipress_vimeo_players[id].on('play',function(e){var id=this._originalElement.getAttribute('data-id');console.log('play',e);gamipress_vimeo_video_change(id,e.duration,'play')});gamipress_vimeo_players[id].on('pause',function(e){var id=this._originalElement.getAttribute('data-id');console.log('pause',e);gamipress_vimeo_video_change(id,e.duration,'pause')});gamipress_vimeo_players[id].on('ended',function(e){var id=this._originalElement.getAttribute('data-id');console.log('ended',e);gamipress_vimeo_video_change(id,e.duration,'ended')})}
function gamipress_vimeo_video_change(id,duration,state){if(gamipress_vimeo_videos[id]===undefined){gamipress_vimeo_videos[id]={state:state,last_state:state,seconds:0,duration:Math.floor(duration),interval:undefined};gamipress_vimeo_videos[id].interval=setInterval(function(){if(gamipress_vimeo_videos[id].last_state==='play')
gamipress_vimeo_videos[id].seconds++;gamipress_vimeo_videos[id].last_state=gamipress_vimeo_videos[id].state},1000)}
gamipress_vimeo_videos[id].state=state;console.log(id,state,gamipress_vimeo_videos[id]);if(state==='play'){}else if(state==='pause'){}else if(state==='ended'){if(gamipress_vimeo_videos[id].seconds<gamipress_vimeo_videos[id].duration&&(gamipress_vimeo_videos[id].seconds+gamipress_vimeo.allowed_delay)>=gamipress_vimeo_videos[id].duration)
gamipress_vimeo_videos[id].seconds+=gamipress_vimeo.allowed_delay;gamipress_vimeo_videos[id].last_state=gamipress_vimeo_videos[id].state;if(gamipress_vimeo_videos[id].seconds>=gamipress_vimeo_videos[id].duration){jQuery.ajax({url:gamipress_vimeo.ajaxurl,type:'POST',data:{action:'gamipress_vimeo_track_watch_video',video_id:id,seconds:gamipress_vimeo_videos[id].seconds,duration:gamipress_vimeo_videos[id].duration,user_id:gamipress_vimeo.user_id,post_id:gamipress_vimeo.post_id},success:function(response){if(gamipress_vimeo.debug_mode)
console.log(response)}}).fail(function(response){if(gamipress_vimeo.debug_mode)
console.log(response)})}
clearInterval(gamipress_vimeo_videos[id].interval);delete gamipress_vimeo_videos[id]}}