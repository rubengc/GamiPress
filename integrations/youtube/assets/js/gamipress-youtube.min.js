var gamipress_youtube_videos={};function onYouTubeIframeAPIReady(){if(gamipress_youtube.debug_mode)
console.log('GamiPress - YouTube Iframe API');var players=document.querySelectorAll('.gamipress-youtube-video');for(var i=0;i<players.length;i++){var player=players[i];if(player.firstChild){player.removeChild(player.firstChild)}
var iframe=new YT.Player(player,{videoId:player.getAttribute('data-id'),height:player.getAttribute('data-height'),width:player.getAttribute('data-width'),playerVars:{'autoplay':(player.getAttribute('data-autoplay')==='yes'?1:0),'controls':(player.getAttribute('data-controls')==='yes'?1:0),},events:{'onStateChange':'gamipress_youtube_video_change'}})}}
function gamipress_youtube_video_change(event){var data=event.target.getVideoData();var id=data.video_id;var duration=event.target.getDuration();var state=event.data;if(gamipress_youtube_videos[id]===undefined){gamipress_youtube_videos[id]={state:state,last_state:state,seconds:0,duration:Math.floor(duration),interval:undefined};gamipress_youtube_videos[id].interval=setInterval(function(){if(gamipress_youtube_videos[id].last_state===YT.PlayerState.PLAYING)
gamipress_youtube_videos[id].seconds++;gamipress_youtube_videos[id].last_state=gamipress_youtube_videos[id].state},1000)}
gamipress_youtube_videos[id].state=state;if(gamipress_youtube.debug_mode)
console.log(id,state,gamipress_youtube_videos[id]);if(state===YT.PlayerState.PLAYING){}else if(state===YT.PlayerState.PAUSED){}else if(state===YT.PlayerState.ENDED){if(gamipress_youtube_videos[id].seconds<gamipress_youtube_videos[id].duration&&(gamipress_youtube_videos[id].seconds+gamipress_youtube.allowed_delay)>=gamipress_youtube_videos[id].duration)
gamipress_youtube_videos[id].seconds+=gamipress_youtube.allowed_delay;gamipress_youtube_videos[id].last_state=gamipress_youtube_videos[id].state;if(gamipress_youtube_videos[id].seconds>=gamipress_youtube_videos[id].duration){jQuery.ajax({url:gamipress_youtube.ajaxurl,type:'POST',data:{action:'gamipress_youtube_track_watch_video',video_id:id,seconds:gamipress_youtube_videos[id].seconds,duration:gamipress_youtube_videos[id].duration,user_id:gamipress_youtube.user_id,post_id:gamipress_youtube.post_id},success:function(response){if(gamipress_youtube.debug_mode)
console.log(response)}}).fail(function(response){if(gamipress_youtube.debug_mode)
console.log(response)})}
clearInterval(gamipress_youtube_videos[id].interval);delete gamipress_youtube_videos[id]}}