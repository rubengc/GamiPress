function gamipress_selector($this){if($this.closest('#available-widgets').length){return}
var select2_args={theme:'default gamipress-select2',placeholder:($this.data('placeholder')?$this.data('placeholder'):gamipress_admin_functions.selector_placeholder),allowClear:!0,multiple:($this[0].hasAttribute('multiple'))};$this.select2(select2_args)}
function gamipress_post_selector($this){if($this.closest('#available-widgets').length){return}
var select2_args={ajax:{url:ajaxurl,dataType:'json',delay:250,type:'POST',data:function(params){return{q:params.term,page:params.page||1,action:'gamipress_get_posts',post_type:$this.data('post-type').split(','),}},processResults:gamipress_select2_posts_process_results},escapeMarkup:function(markup){return markup},templateResult:gamipress_select2_posts_template_result,theme:'default gamipress-select2',placeholder:($this.data('placeholder')?$this.data('placeholder'):gamipress_admin_functions.post_selector_placeholder),allowClear:!0,multiple:($this[0].hasAttribute('multiple'))};$this.select2(select2_args)}
function gamipress_user_selector($this){if($this.closest('#available-widgets').length){return}
var select2_args={ajax:{url:ajaxurl,dataType:'json',delay:250,type:'POST',data:function(params){return{q:params.term,page:params.page||1,action:'gamipress_get_users',}},processResults:gamipress_select2_users_process_results},escapeMarkup:function(markup){return markup},templateResult:gamipress_select2_users_template_result,theme:'default gamipress-select2',placeholder:($this.data('placeholder')?$this.data('placeholder'):gamipress_admin_functions.user_selector_placeholder),allowClear:!0,multiple:($this[0].hasAttribute('multiple'))};$this.select2(select2_args)}
function gamipress_select2_posts_template_result(item){if(item.post_type!==undefined){var post_type_label=item.post_type;if(gamipress_post_type_exists(item.post_type)){post_type_label=gamipress_get_post_type_label(item.post_type)}
return '<strong>'+item.post_title+'</strong>'+'<span class="result-description">'+'ID: '+item.ID+'<span class="align-right">'+post_type_label+'</span>'+(item.site_name!==undefined?' ('+item.site_name+')':'')+'</span>'}
return item.text}
function gamipress_select2_posts_process_results(response,params){if(response===null){return{results:[]}}
var formatted_results=[];var results=(response.data.results!==undefined?response.data.results:response.data);results.forEach(function(item){formatted_results.push(jQuery.extend({id:item.ID,text:item.post_title+' (#'+item.ID+')',},item))});return{results:formatted_results,pagination:{more:(response.data.more_results!==undefined?response.data.more_results:!1)}}}
function gamipress_select2_users_template_result(item){if(item.display_name!==undefined){return '<strong>'+item.display_name+'</strong>'+'<span class="result-description">'+'ID: '+item.ID+' - '+item.user_email+' ('+item.user_login+')'+'</span>'}
return item.text}
function gamipress_select2_users_process_results(response,params){if(response===null){return{results:[]}}
var formatted_results=[];var results=(response.data.results!==undefined?response.data.results:response.data);results.forEach(function(item){formatted_results.push(jQuery.extend({id:item.ID,text:item.user_login+' (#'+item.ID+')',},item))});return{results:formatted_results,pagination:{more:(response.data.more_results!==undefined?response.data.more_results:!1)}}}
function gamipress_select2_optgroup_matcher(params,data){data.parentText=data.parentText||'';if(params.term===undefined){return data}
if(params.term.trim()===''){return data}
if(data.children&&data.children.length>0){var match=jQuery.extend(!0,{},data);for(var c=data.children.length-1;c>=0;c--){var child=data.children[c];child.parentText+=data.parentText+" "+data.text;var matches=gamipress_select2_optgroup_matcher(params,child);if(matches==null){match.children.splice(c,1)}}
if(match.children.length>0){return match}
return gamipress_select2_optgroup_matcher(params,match)}
var original=(data.parentText+' '+data.text).toUpperCase();var term=params.term.toUpperCase();if(original.indexOf(term)>-1){return data}
return null}
function gamipress_is_select2_updated(show_in_console){if(show_in_console===undefined)
show_in_console=!1;try{jQuery('<select id="gamipress-select2-version-check" style="display: none;"><option value=""></option></select>').insertAfter('body');jQuery("#gamipress-select2-version-check").select2({theme:'gamipress-select2-hidden'});jQuery("#gamipress-select2-version-check").select2('isOpen');if(show_in_console)
console.log('Select2 is up to date!');return!0}catch(e){if(show_in_console)
console.log('Select2 is outdated!');return!1}}
function gamipress_post_type_exists(post_type){return(gamipress_admin_functions.post_type_labels[post_type]!==undefined)}
function gamipress_get_post_type_label(post_type){var label='';if(gamipress_post_type_exists(post_type)){label=gamipress_admin_functions.post_type_labels[post_type]}
return label}
function gamipress_download_csv(data,filename){var csv=gamipress_object_to_csv(data);var file=(filename.length?filename+'.csv':'export.csv');var blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});if(navigator.msSaveBlob){navigator.msSaveBlob(blob,file)}else{var link=document.createElement("a");link.style.visibility='hidden';if(link.download!==undefined){var url=URL.createObjectURL(blob);link.setAttribute("href",url);link.setAttribute("download",file);document.body.appendChild(link);link.click();document.body.removeChild(link)}}}
function gamipress_object_to_csv(obj){var array=typeof obj!=='object'?JSON.parse(obj):obj;var str='';for(var i=0;i<array.length;i++){var line='';for(var index in array[i]){if(line!==''){line+=','}
line+='"'+array[i][index]+'"'}
str+=line+'\r\n'}
return str}