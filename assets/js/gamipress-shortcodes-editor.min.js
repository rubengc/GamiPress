(function($){function gamipress_insert_shortcode(){var shortcode=gamipress_get_selected_shortcode();var attributes=gamipress_get_attributes(shortcode);var constructed=gamipress_construct_shortcode(shortcode,attributes);window.send_to_editor(constructed)}
function gamipress_get_selected_shortcode(){return $('#select_shortcode').val()}
function gamipress_get_attributes(shortcode){var attrs={};var inputs=gamipress_get_shortcode_inputs(shortcode);$.each(inputs,function(index,el){var key,value;if($(el).closest('.cmb-row').hasClass('cmb-repeat-row')){var field_name=el.name.split('[')[0];key=el.name.replace(shortcode+'_','').replace('[]','');key=key.split('[')[0];if(attrs[key]===undefined){var fields=$(el).closest('.cmb-tbody').find('[name^="'+field_name+'"]');var values=[];for(var i=0;i<fields.length;i++){var field=$(fields[i]);if(field.val().length){values.push(field.val())}}
attrs[key]=values.join(',')}}else{value=$(el).val();if($(el).attr('type')==='checkbox'){value=$(el).prop('checked')?'yes':'no'}
if($(el).attr('type')==='radio'){value=$(el).closest('.cmb2-radio-list').find('input[type="radio"]:checked').val()}
if(typeof value==='string'){value=value.replace(/"/g,"'")}
if(value!==''&&value!==undefined&&value!==null){key=el.name.replace(shortcode+'_','').replace('[]','');attrs[key]=value}}});var args={attributes:attrs,inputs:inputs};$('#'+shortcode+'_wrapper').trigger('gamipress_shortcode_attributes',[args]);$('#'+shortcode+'_wrapper').trigger('gamipress_get_shortcode_attributes',[args.attributes,args.inputs]);return args.attributes}
function gamipress_get_shortcode_inputs(shortcode){return $('input, select, textarea','#'+shortcode+'_wrapper .cmb2-wrap')}
function gamipress_construct_shortcode(shortcode,attributes){var output='[';output+=shortcode;$.each(attributes,function(key,value){output+=' '+key+'="'+value+'"'});$.trim(output);output+=']';var args={output:output,shortcode:shortcode,attributes:attributes};$('#'+shortcode+'_wrapper').trigger('gamipress_construct_shortcode',[args]);return args.output}
function gamipress_shortcode_hide_all_sections(){$('.shortcode-section').hide()}
function gamipress_shortcode_show_section(section_name){$('#'+section_name+'_wrapper').show()}
$('#select_shortcode').on('change',function(){gamipress_shortcode_hide_all_sections();gamipress_shortcode_show_section(gamipress_get_selected_shortcode())}).change();$('#gamipress_insert').on('click',function(e){e.preventDefault();gamipress_insert_shortcode()});$('#gamipress_cancel').on('click',function(e){e.preventDefault();tb_remove()});var select2_achievements={ajax:{url:ajaxurl,dataType:'json',delay:250,type:'POST',data:function(params){return{q:params.term,action:'gamipress_get_achievements_options'}},processResults:gamipress_select2_posts_process_results},escapeMarkup:function(markup){return markup},templateResult:gamipress_select2_posts_template_result,theme:'default gamipress-select2',placeholder:gamipress_shortcodes_editor.id_placeholder,allowClear:!0,multiple:!1};var select2_achievements_multiple=$.extend(!0,{},select2_achievements,{multiple:!0});$('#gamipress_achievement_id').select2(select2_achievements);$('#gamipress_achievements_include, #gamipress_achievements_exclude, #gamipress_logs_include, #gamipress_logs_exclude').select2(select2_achievements_multiple);$('#gamipress_achievements_type, #gamipress_points_types_type, #gamipress_points_type, #gamipress_ranks_type, #gamipress_logs_type, #gamipress_earnings_points_types, #gamipress_earnings_achievement_types, #gamipress_earnings_rank_types').select2({theme:'default gamipress-select2',placeholder:gamipress_shortcodes_editor.post_type_placeholder,allowClear:!0,multiple:!0});$('#gamipress_achievements_user_id, #gamipress_logs_user_id, #gamipress_points_user_id, #gamipress_rank_user_id, #gamipress_ranks_user_id, #gamipress_user_rank_user_id, #gamipress_earnings_user_id').select2({ajax:{url:ajaxurl,dataType:'json',delay:250,type:'POST',data:function(params){return{q:params.term,page:params.page||1,action:'gamipress_get_users'}},processResults:gamipress_select2_users_process_results},escapeMarkup:function(markup){return markup},templateResult:gamipress_select2_users_template_result,theme:'default gamipress-select2',placeholder:gamipress_shortcodes_editor.user_placeholder,allowClear:!0,multiple:!1});$('#gamipress_achievements_current_user, #gamipress_points_current_user, #gamipress_logs_current_user, #gamipress_ranks_current_user, #gamipress_user_rank_current_user, #gamipress_earnings_current_user').change(function(){var target=$(this).closest('.cmb-row').next();if($(this).prop('checked')){target.slideUp().addClass('cmb2-tab-ignore')}else{if(target.closest('.cmb-tabs-wrap').length){if(target.hasClass('cmb-tab-active-item')){target.slideDown()}}else{target.slideDown()}
target.removeClass('cmb2-tab-ignore')}});var select2_ranks={ajax:{url:ajaxurl,dataType:'json',delay:250,type:'POST',data:function(params){return{q:params.term,action:'gamipress_get_ranks_options'}},processResults:gamipress_select2_posts_process_results},escapeMarkup:function(markup){return markup},templateResult:gamipress_select2_posts_template_result,theme:'default gamipress-select2',placeholder:gamipress_shortcodes_editor.rank_placeholder,allowClear:!0,multiple:!1};var select2_ranks_multiple=$.extend(!0,{},select2_ranks,{multiple:!0});$('#gamipress_rank_id').select2(select2_ranks);$('#gamipress_ranks_include, #gamipress_ranks_exclude').select2(select2_ranks_multiple);$('#gamipress_earnings_points, #gamipress_earnings_achievements, #gamipress_earnings_ranks').change(function(){var id=$(this).attr('id');var target=undefined;if(id==='gamipress_earnings_points'){target=$('.cmb2-id-gamipress-earnings-points-types, .cmb2-id-gamipress-earnings-awards, .cmb2-id-gamipress-earnings-deducts')}else if(id==='gamipress_earnings_achievements'){target=$('.cmb2-id-gamipress-earnings-achievement-types, .cmb2-id-gamipress-earnings-steps')}else if(id==='gamipress_earnings_ranks'){target=$('.cmb2-id-gamipress-earnings-rank-types, .cmb2-id-gamipress-earnings-rank-requirements')}
if($(this).prop('checked')){if($(this).closest('.cmb-tabs-wrap').find('.cmb-tab.active[id$="'+id+'"]').length){target.slideDown()}
target.removeClass('cmb2-tab-ignore')}else{target.slideUp().addClass('cmb2-tab-ignore')}});$('body').on('click','#insert_gamipress_shortcodes',function(e){e.preventDefault();gamipress_shortcode_setup_thickbox($(this))});function gamipress_shortcode_setup_thickbox(link){setTimeout(function(){$('#TB_window').addClass('gamipress-shortcode-thickbox');$('select.select2-hidden-accessible','.gamipress-shortcode-thickbox .cmb2-wrap').val('').change();$('input[type="checkbox"]','.gamipress-shortcode-thickbox .cmb2-wrap').change()},0)}}(jQuery))